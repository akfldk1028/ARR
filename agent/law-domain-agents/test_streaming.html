<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAS ì§„í–‰ìƒí™© ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° í…ŒìŠ¤íŠ¸</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }

        input {
            flex: 1;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            padding: 15px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .progress-section {
            display: none;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .progress-section.active {
            display: block;
        }

        .agent-badge {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .agent-icon {
            font-size: 24px;
        }

        .agent-info {
            flex: 1;
        }

        .agent-name {
            font-weight: 600;
            font-size: 18px;
            color: #333;
        }

        .node-count {
            font-size: 14px;
            color: #666;
        }

        .current-stage {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            font-size: 16px;
            color: #555;
            font-weight: 500;
        }

        .stage-icon {
            font-size: 24px;
        }

        .progress-bar-container {
            height: 8px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        .stage-checklist {
            list-style: none;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .stage-checklist li {
            padding: 10px 15px;
            background: white;
            border-radius: 8px;
            color: #999;
            transition: all 0.3s;
        }

        .stage-checklist li.done {
            color: #22c55e;
            font-weight: 600;
            background: #f0fdf4;
            border-left: 3px solid #22c55e;
        }

        .results-section {
            display: none;
        }

        .results-section.active {
            display: block;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .results-header h2 {
            color: #333;
            font-size: 24px;
        }

        .response-time {
            padding: 8px 16px;
            background: #22c55e;
            color: white;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
        }

        .result-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .result-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 10px;
        }

        .result-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .result-law {
            font-size: 14px;
            color: #667eea;
            font-weight: 500;
        }

        .similarity-badge {
            padding: 6px 12px;
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            color: #0369a1;
        }

        .result-content {
            color: #555;
            line-height: 1.6;
            font-size: 15px;
        }

        .error-message {
            background: #fee2e2;
            border: 1px solid #fca5a5;
            color: #991b1b;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
        }

        .error-message.active {
            display: block;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        .searching-animation {
            animation: pulse 1.5s ease-in-out infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤– MAS ì§„í–‰ìƒí™© ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë°</h1>
        <p class="subtitle">Law Domain Agentsì˜ ê²€ìƒ‰ ì§„í–‰ìƒí™©ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ í™•ì¸í•´ë³´ì„¸ìš”!</p>

        <div class="search-box">
            <input
                type="text"
                id="query"
                placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 36ì¡°, ìš©ë„ì§€ì—­, ê°œë°œí–‰ìœ„í—ˆê°€)"
                value="36ì¡°"
            />
            <button id="searchBtn" onclick="search()">ê²€ìƒ‰</button>
        </div>

        <div id="progressSection" class="progress-section">
            <div class="agent-badge">
                <span class="agent-icon">ğŸ¤–</span>
                <div class="agent-info">
                    <div class="agent-name" id="agentName">ëŒ€ê¸° ì¤‘...</div>
                    <div class="node-count" id="nodeCount"></div>
                </div>
            </div>

            <div class="current-stage searching-animation">
                <span class="stage-icon" id="stageIcon">ğŸ”„</span>
                <span id="stageName">ê²€ìƒ‰ ì¤€ë¹„ ì¤‘...</span>
            </div>

            <div class="progress-bar-container">
                <div class="progress-bar-fill" id="progressBar" style="width: 0%"></div>
            </div>

            <ul class="stage-checklist">
                <li id="stage-exact">ğŸ¯ ì •í™• ì¼ì¹˜ ê²€ìƒ‰</li>
                <li id="stage-vector">ğŸ” ë²¡í„° ìœ ì‚¬ë„ ê²€ìƒ‰</li>
                <li id="stage-relationship">ğŸ”— ê´€ê³„ ì„ë² ë”© ê²€ìƒ‰</li>
                <li id="stage-rne">ğŸŒ³ RNE ê·¸ë˜í”„ í™•ì¥</li>
                <li id="stage-enrichment">âœ¨ ê²°ê³¼ ê°•í™”</li>
            </ul>
        </div>

        <div id="resultsSection" class="results-section">
            <div class="results-header">
                <h2>ê²€ìƒ‰ ê²°ê³¼</h2>
                <div class="response-time" id="responseTime"></div>
            </div>
            <div id="resultsContainer"></div>
        </div>

        <div id="errorMessage" class="error-message"></div>
    </div>

    <script>
        let eventSource = null;

        const stageIcons = {
            'exact_match': 'ğŸ¯',
            'vector_search': 'ğŸ”',
            'relationship_search': 'ğŸ”—',
            'rne_expansion': 'ğŸŒ³',
            'enrichment': 'âœ¨'
        };

        const stageElements = {
            'exact_match': 'stage-exact',
            'vector_search': 'stage-vector',
            'relationship_search': 'stage-relationship',
            'rne_expansion': 'stage-rne',
            'enrichment': 'stage-enrichment'
        };

        function search() {
            const query = document.getElementById('query').value.trim();
            if (!query) {
                alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }

            // ê¸°ì¡´ ì—°ê²° ì¢…ë£Œ
            if (eventSource) {
                eventSource.close();
            }

            // UI ì´ˆê¸°í™”
            resetUI();
            document.getElementById('progressSection').classList.add('active');
            document.getElementById('resultsSection').classList.remove('active');
            document.getElementById('errorMessage').classList.remove('active');
            document.getElementById('searchBtn').disabled = true;

            // SSE ì—°ê²°
            const url = `http://localhost:8011/api/search/stream?query=${encodeURIComponent(query)}&limit=5`;
            eventSource = new EventSource(url);

            eventSource.onmessage = (event) => {
                const data = JSON.parse(event.data);
                console.log('Event:', data);
                handleEvent(data);
            };

            eventSource.onerror = (error) => {
                console.error('SSE Error:', error);
                eventSource.close();
                showError('ì—°ê²° ì‹¤íŒ¨: ì„œë²„ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
                document.getElementById('searchBtn').disabled = false;
            };
        }

        function handleEvent(data) {
            switch(data.status) {
                case 'started':
                    document.getElementById('agentName').textContent = data.agent;
                    document.getElementById('nodeCount').textContent = `${data.node_count} ë…¸ë“œ ê´€ë¦¬ ì¤‘`;
                    break;

                case 'searching':
                case 'processing':
                    updateProgress(data);
                    break;

                case 'complete':
                    showResults(data);
                    eventSource.close();
                    document.getElementById('searchBtn').disabled = false;
                    break;

                case 'error':
                    showError(data.message);
                    eventSource.close();
                    document.getElementById('searchBtn').disabled = false;
                    break;
            }
        }

        function updateProgress(data) {
            // Progress bar
            const progress = (data.progress || 0) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;

            // Stage icon and name
            const icon = stageIcons[data.stage] || 'ğŸ”„';
            document.getElementById('stageIcon').textContent = icon;
            document.getElementById('stageName').textContent = data.stage_name || 'Processing...';

            // Checklist
            const stageId = stageElements[data.stage];
            if (stageId) {
                document.getElementById(stageId).classList.add('done');
            }
        }

        function showResults(data) {
            document.getElementById('progressSection').classList.remove('active');
            document.getElementById('resultsSection').classList.add('active');

            const responseTime = document.getElementById('responseTime');
            responseTime.textContent = `${data.response_time}ms`;

            const container = document.getElementById('resultsContainer');
            container.innerHTML = '';

            if (!data.results || data.results.length === 0) {
                container.innerHTML = '<p style="text-align:center;color:#666;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            data.results.forEach(result => {
                const card = document.createElement('div');
                card.className = 'result-card';
                card.innerHTML = `
                    <div class="result-header">
                        <div>
                            <div class="result-title">${result.article || 'N/A'}</div>
                            <div class="result-law">${result.law_name || 'N/A'} (${result.law_type || 'N/A'})</div>
                        </div>
                        <div class="similarity-badge">
                            ìœ ì‚¬ë„ ${(result.similarity * 100).toFixed(1)}%
                        </div>
                    </div>
                    <div class="result-content">${result.content.substring(0, 200)}...</div>
                `;
                container.appendChild(card);
            });
        }

        function showError(message) {
            document.getElementById('progressSection').classList.remove('active');
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.classList.add('active');
        }

        function resetUI() {
            document.getElementById('progressBar').style.width = '0%';
            document.getElementById('agentName').textContent = 'ëŒ€ê¸° ì¤‘...';
            document.getElementById('nodeCount').textContent = '';
            document.getElementById('stageIcon').textContent = 'ğŸ”„';
            document.getElementById('stageName').textContent = 'ê²€ìƒ‰ ì¤€ë¹„ ì¤‘...';

            // Reset checklist
            Object.values(stageElements).forEach(id => {
                document.getElementById(id).classList.remove('done');
            });

            document.getElementById('resultsContainer').innerHTML = '';
        }

        // Enter key support
        document.getElementById('query').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                search();
            }
        });
    </script>
</body>
</html>
