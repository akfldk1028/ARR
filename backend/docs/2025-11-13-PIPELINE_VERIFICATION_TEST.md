# ë²•ê·œ ì‹œìŠ¤í…œ ì „ì²´ íŒŒì´í”„ë¼ì¸ ê²€ì¦ í…ŒìŠ¤íŠ¸

**ì‘ì„±ì¼**: 2025-11-13
**ëª©ì **: PDF íŒŒì‹±ë¶€í„° DomainAgent ê²€ìƒ‰ê¹Œì§€ ì „ì²´ ì‹œìŠ¤í…œ ìˆœì°¨ì  ê²€ì¦
**ìƒíƒœ**: âœ… ì™„ë£Œ (ëª¨ë“  ë‹¨ê³„ ì •ìƒ ì‘ë™)

---

## ğŸ¯ í…ŒìŠ¤íŠ¸ ê°œìš”

PDF ì›ë³¸ íŒŒì¼ë¶€í„° ì‹œì‘í•˜ì—¬ ì „ì²´ íŒŒì´í”„ë¼ì¸ì´ ì˜¬ë°”ë¥´ê²Œ ì‘ë™í•˜ëŠ”ì§€ ìˆœì°¨ì ìœ¼ë¡œ ê²€ì¦í–ˆìŠµë‹ˆë‹¤.

### ê²€ì¦ ìˆœì„œ

1. Neo4j í˜„ì¬ ìƒíƒœ í™•ì¸
2. PDF ì›ë³¸ íŒŒì¼ ì¡´ì¬ ë° êµ¬ì¡° í™•ì¸
3. JSON íŒŒì‹± ê²°ê³¼ ê²€ì¦
4. Neo4j ê·¸ë˜í”„ êµ¬ì¡° ê²€ì¦
5. HANG ë…¸ë“œ ì„ë² ë”© ìƒíƒœ í™•ì¸
6. Domain ë…¸ë“œ ë° BELONGS_TO_DOMAIN ê´€ê³„ í™•ì¸
7. CONTAINS ê´€ê³„ ì„ë² ë”© í™•ì¸
8. DomainAgent í†µí•© ê²€ìƒ‰ í…ŒìŠ¤íŠ¸

---

## âœ… ê²€ì¦ ê²°ê³¼ ìƒì„¸

### 1. PDF ì›ë³¸ íŒŒì¼ (âœ… í†µê³¼)

**ìœ„ì¹˜**: `law/data/raw/`

```
04_êµ­í† ì˜ ê³„íš ë° ì´ìš©ì— ê´€í•œ ë²•ë¥ (ë²•ë¥ )(ì œ19117í˜¸)(20230628).pdf    468KB
05_êµ­í† ì˜ ê³„íš ë° ì´ìš©ì— ê´€í•œ ë²•ë¥  ì‹œí–‰ë ¹(ëŒ€í†µë ¹ë ¹)(ì œ33637í˜¸)(20230718).pdf    2.3MB
06_êµ­í† ì˜ ê³„íš ë° ì´ìš©ì— ê´€í•œ ë²•ë¥  ì‹œí–‰ê·œì¹™(êµ­í† êµí†µë¶€ë ¹)(ì œ01192í˜¸)(20230127).pdf    1.9MB
```

**ê²°ê³¼**: 3ê°œ PDF íŒŒì¼ ì •ìƒ ì¡´ì¬ (ì´ 4.6MB)

---

### 2. JSON íŒŒì‹± ê²°ê³¼ (âœ… í†µê³¼)

**ìœ„ì¹˜**: `law/data/parsed/`

```
êµ­í† ì˜_ê³„íš_ë°_ì´ìš©ì—_ê´€í•œ_ë²•ë¥ _ë²•ë¥ .json         1006KB
êµ­í† ì˜_ê³„íš_ë°_ì´ìš©ì—_ê´€í•œ_ë²•ë¥ _ì‹œí–‰ê·œì¹™.json      235KB
êµ­í† ì˜_ê³„íš_ë°_ì´ìš©ì—_ê´€í•œ_ë²•ë¥ _ì‹œí–‰ë ¹.json       1.4MB
```

**êµ¬ì¡° ê²€ì¦ (ë²•ë¥  íŒŒì¼ ê¸°ì¤€)**:
- ì „ì²´ units: 1,554ê°œ
- íƒ€ì…ë³„ ë¶„í¬:
  - í•­(HANG): 746ê°œ
  - ì¡°(JO): 460ê°œ
  - í˜¸(HO): 298ê°œ
  - ì ˆ(JEOL): 27ê°œ
  - ì¥(JANG): 12ê°œ
  - í¸(PYEON): 11ê°œ

**JSON í‚¤ êµ¬ì¡°**:
```json
{
  "law_info": {...},
  "units": [
    {
      "unit_type": "í•­",
      "unit_number": 1,
      "title": "ê·œì¹™",
      "content": "ì œ1ì¡° ê·œì¹™",
      "unit_path": "ì œ1ì¡°",
      "full_id": "êµ­í† ì˜ ê³„íš ë° ì´ìš©ì— ê´€í•œ ë²•ë¥ ::ì œ1ì¡°",
      "parent_id": "êµ­í† ì˜ ê³„íš ë° ì´ìš©ì— ê´€í•œ ë²•ë¥ ",
      "order": 1,
      "revision_dates": [],
      "metadata": {...}
    }
  ]
}
```

**ê²°ê³¼**: ê³„ì¸µ êµ¬ì¡° ì •ìƒ íŒŒì‹± (LAW â†’ JANG â†’ JEOL â†’ JO â†’ HANG â†’ HO)

---

### 3. Neo4j ê·¸ë˜í”„ ë°ì´í„°ë² ì´ìŠ¤ (âœ… í†µê³¼)

#### 3.1 ë…¸ë“œ ìˆ˜

**ì „ì²´ ë…¸ë“œ: 3,602ê°œ**

| ë…¸ë“œ íƒ€ì… | ê°œìˆ˜ | ì„¤ëª… |
|---------|------|------|
| HANG | 1,477 | í•­ (ì‹¤ì œ ë²•ë¥  ë‚´ìš©) |
| HO | 1,022 | í˜¸ |
| JO | 770 | ì¡° |
| MOK | 261 | ëª© |
| JANG | 12 | ì¥ |
| JEOL | 11 | ì ˆ |
| **Domain** | **5** | **ë„ë©”ì¸ (MAS)** |
| LAW | 3 | ë²•ë¥ , ì‹œí–‰ë ¹, ì‹œí–‰ê·œì¹™ |
| Message | 12 | í…ŒìŠ¤íŠ¸ ë°ì´í„° |
| Conversation | 9 | í…ŒìŠ¤íŠ¸ ë°ì´í„° |
| Turn | 3 | í…ŒìŠ¤íŠ¸ ë°ì´í„° |

#### 3.2 ê´€ê³„ ìˆ˜

**ì „ì²´ ê´€ê³„: 7,500+ê°œ**

| ê´€ê³„ íƒ€ì… | ê°œìˆ˜ | ì„¤ëª… |
|----------|------|------|
| CONTAINS | 3,565 | ê³„ì¸µ ê´€ê³„ (ë¶€ëª¨ â†’ ìì‹) |
| NEXT | 2,842 | ìˆœì°¨ ê´€ê³„ (í˜•ì œê°„) |
| **BELONGS_TO_DOMAIN** | **1,477** | **HANG â†’ Domain** |
| HAS_MESSAGE | 12 | í…ŒìŠ¤íŠ¸ ë°ì´í„° |
| STARTED_CONVERSATION | 6 | í…ŒìŠ¤íŠ¸ ë°ì´í„° |

#### 3.3 ê³„ì¸µ êµ¬ì¡° ìƒ˜í”Œ

**ì‹¤ì œ Neo4j ê²½ë¡œ**:
```
LAW: êµ­í† ì˜ ê³„íš ë° ì´ìš©ì— ê´€í•œ ë²•ë¥ ::ì‹œí–‰ê·œì¹™
  â†“ (CONTAINS)
JO: êµ­í† ì˜ ê³„íš ë° ì´ìš©ì— ê´€í•œ ë²•ë¥ ::ì œ3ì¡°
  â†“ (CONTAINS)
HANG: êµ­í† ì˜ ê³„íš ë° ì´ìš©ì— ê´€í•œ ë²•ë¥ ::ì œ3ì¡°::â‘ 
```

#### 3.4 JO â†’ HANG ê´€ê³„ ê²€ì¦

```cypher
MATCH (jo:JO)-[r:CONTAINS]->(hang:HANG)
RETURN count(*) as count
```

**ê²°ê³¼**: 1,477ê°œ CONTAINS ê´€ê³„ (100% ì„ë² ë”© í¬í•¨)

#### 3.5 HANG ë…¸ë“œ ìƒì„¸ ì •ë³´ ìƒ˜í”Œ

**ìƒ˜í”Œ 1**:
- full_id: `êµ­í† ì˜ ê³„íš ë° ì´ìš©ì— ê´€í•œ ë²•ë¥ ::ì œ10ì¡°ì˜4::â‘ `
- content: `ê³µì‘ë¬¼ì˜ ì„¤ì¹˜(ã€Œê±´ì¶•ë²•ã€ ì œ83ì¡°ì— ë”°ë¼ ì„¤ì¹˜ë˜ëŠ” ê²ƒì€ ì œì™¸í•œë‹¤), í† ì§€ì˜ í˜•ì§ˆë³€ê²½ ë˜ëŠ” ...`
- embedding_dim: 768

**ìƒ˜í”Œ 2**:
- full_id: `êµ­í† ì˜ ê³„íš ë° ì´ìš©ì— ê´€í•œ ë²•ë¥ ::ì œ11ì¡°ì˜3::â‘ `
- content: `ì˜ ì œ70ì¡°ì˜3ì œ1í•­ì— ë”°ë¥¸ ê¸°ë°˜ì‹œì„¤ì„¤ì¹˜ë¹„ìš©ì˜ ì˜ˆì • í†µì§€ëŠ” ë³„ì§€ ì œ 17í˜¸ì˜2ì„œì‹ì— ë”°ë¥¸ë‹¤...`
- embedding_dim: 768

#### 3.6 HANGì˜ ìƒìœ„ JO ê´€ê³„ í™•ì¸

**ì˜ˆì‹œ**:
```cypher
MATCH (jo:JO)-[:CONTAINS]->(hang:HANG)
WHERE hang.full_id = 'êµ­í† ì˜ ê³„íš ë° ì´ìš©ì— ê´€í•œ ë²•ë¥ ::ì œ12ì¥::ì œ4ì ˆ::ì œ56ì¡°::â‘ '
RETURN jo.full_id, jo.title
```

**ê²°ê³¼**:
- JO: `êµ­í† ì˜ ê³„íš ë° ì´ìš©ì— ê´€í•œ ë²•ë¥ ::ì œ12ì¥::ì œ4ì ˆ::ì œ56ì¡°`
- title: `ê°œë°œí–‰ìœ„ì˜ í—ˆê°€`

**ê²°ê³¼**: Neo4j ê·¸ë˜í”„ êµ¬ì¡° ì •ìƒ

---

### 4. HANG ë…¸ë“œ ì„ë² ë”© (âœ… í†µê³¼)

**ëª¨ë¸**: KR-SBERT (`jhgan/ko-sbert-sts`)
**ì°¨ì›**: 768ì°¨ì›
**ì´ ê°œìˆ˜**: 1,477ê°œ (100%)

#### ì„ë² ë”© í†µê³„

```
ì´ ê°œìˆ˜: 1477ê°œ
ì°¨ì›: 768ì°¨ì›
ê°’ ë²”ìœ„: [-2.5110, 1.6712]
í‰ê· : -0.0020
í‘œì¤€í¸ì°¨: 0.6107
```

**ì •ê·œí™” ìƒíƒœ**: âœ… ì •ìƒ (í‰ê·  ~0, í‘œì¤€í¸ì°¨ ì ì ˆ)

#### ë²¡í„° ì¸ë±ìŠ¤

```cypher
SHOW INDEXES
```

**ê²°ê³¼**: `hang_embedding_index` (VECTOR, ONLINE) âœ…

---

### 5. CONTAINS ê´€ê³„ ì„ë² ë”© (âœ… í†µê³¼)

**ëª¨ë¸**: OpenAI `text-embedding-3-large`
**ì°¨ì›**: 3,072ì°¨ì›
**ì´ ê°œìˆ˜**: 3,565ê°œ (100%)

#### ì„ë² ë”© í†µê³„

```
ì´ ê°œìˆ˜: 3565ê°œ
ì°¨ì›: 3072ì°¨ì›
ê°’ ë²”ìœ„: [-0.0774, 0.0777]
í‰ê· : 0.0003
í‘œì¤€í¸ì°¨: 0.0180
```

**ì •ê·œí™” ìƒíƒœ**: âœ… ì •ìƒ (OpenAI ì„ë² ë”© íŠ¹ì„±)

#### context ìƒ˜í”Œ

```
"ê³„ì¸µ êµ¬ì¡° ê´€ê³„..."
```

#### ë²¡í„° ì¸ë±ìŠ¤

**ê²°ê³¼**: `contains_embedding` (VECTOR, ONLINE) âœ…

---

### 6. Domain ë…¸ë“œ ë° AgentManager (âœ… í†µê³¼)

#### 6.1 Neo4j Domain ë…¸ë“œ

**ì´ 5ê°œ ë„ë©”ì¸**:

| domain_id | domain_name | HANG ìˆ˜ | ë¹„ìœ¨ |
|-----------|-------------|---------|------|
| domain_c283b545 | ë„ì‹œê³„íš ë° ë‚©ë¶€ ì ˆì°¨ | 510 | 34.5% |
| domain_676e7400 | í† ì§€ ì´ìš© ë° ê¸°ë°˜ì‹œì„¤ | 389 | 26.3% |
| domain_3be25bdc | êµ­í†  ì´ìš© ë° ê´€ë¦¬ | 230 | 15.6% |
| domain_fad24752 | ë„ì‹œ ë° êµ° ê³„íš | 227 | 15.4% |
| domain_09b3af0d | êµ­í†  ê³„íš ë° ì´ìš© | 121 | 8.2% |

**ì „ì²´ í• ë‹¹**: 1,477ê°œ / 1,477ê°œ HANG (100%) âœ…

#### 6.2 AgentManager ì´ˆê¸°í™”

```python
from agents.law.agent_manager import AgentManager
manager = AgentManager()
```

**ë¡œê·¸ ì¶œë ¥**:
```
[INFO] Loaded domain from Neo4j: êµ­í†  ê³„íš ë° ì´ìš© (121 nodes)
[INFO] Loaded domain from Neo4j: êµ­í†  ì´ìš© ë° ê´€ë¦¬ (230 nodes)
[INFO] Loaded domain from Neo4j: ë„ì‹œ ë° êµ° ê³„íš (227 nodes)
[INFO] Loaded domain from Neo4j: ë„ì‹œê³„íš ë° ë‚©ë¶€ ì ˆì°¨ (510 nodes)
[INFO] Loaded domain from Neo4j: í† ì§€ ì´ìš© ë° ê¸°ë°˜ì‹œì„¤ (389 nodes)
[INFO] Loaded 5 domains from Neo4j
[INFO] Loading embeddings for 1477 nodes from Neo4j...
[INFO] Loaded 1477 embeddings from Neo4j
[INFO] AgentManager initialized
```

**ê²°ê³¼**: ìƒì„±ëœ ë„ë©”ì¸ 5ê°œ âœ…

#### 6.3 BELONGS_TO_DOMAIN ê´€ê³„

```cypher
MATCH (h:HANG)-[:BELONGS_TO_DOMAIN]->(d:Domain)
RETURN d.domain_name, count(h) as hang_count
ORDER BY hang_count DESC
```

**ê²°ê³¼**:
- ë„ì‹œê³„íš ë° ë‚©ë¶€ ì ˆì°¨: 510ê°œ
- í† ì§€ ì´ìš© ë° ê¸°ë°˜ì‹œì„¤: 389ê°œ
- êµ­í†  ì´ìš© ë° ê´€ë¦¬: 230ê°œ

**ê²°ê³¼**: 1,477ê°œ HANG ë…¸ë“œ 100% ë„ë©”ì¸ í• ë‹¹ âœ…

---

### 7. ë²¡í„° ì¸ë±ìŠ¤ ìƒíƒœ (âœ… í†µê³¼)

**ì „ì²´ ë²¡í„° ì¸ë±ìŠ¤: 4ê°œ (ëª¨ë‘ ONLINE)**

| ì¸ë±ìŠ¤ ì´ë¦„ | íƒ€ì… | ìƒíƒœ | ìš©ë„ |
|-----------|------|------|------|
| `hang_embedding_index` | VECTOR | ONLINE | HANG ë…¸ë“œ ê²€ìƒ‰ |
| `contains_embedding` | VECTOR | ONLINE | ê´€ê³„ ê²€ìƒ‰ |
| `domain_centroid_idx` | VECTOR | ONLINE | Domain ì¤‘ì‹¬ì  |
| `vector` | VECTOR | ONLINE | ê¸°íƒ€ |

**ê²°ê³¼**: ëª¨ë“  ì¸ë±ìŠ¤ ì •ìƒ âœ…

---

### 8. DomainAgent í†µí•© ê²€ìƒ‰ í…ŒìŠ¤íŠ¸ (âœ… í†µê³¼)

#### í…ŒìŠ¤íŠ¸ íŒŒì¼

**ì‹¤í–‰**: `python law/test_domain_agent_final.py`

#### í…ŒìŠ¤íŠ¸ ì¿¼ë¦¬ 3ê°œ

**ì¿¼ë¦¬ 1**: (ë„ë©”ì¸ì— ì í•©í•œ ì§ˆì˜)
```
ê²€ìƒ‰ í†µê³„:
ì´ 10ê°œ ì¡°í•­ ë°œê²¬
- ë…¸ë“œ ì„ë² ë”©: 5ê°œ
- ê´€ê³„ ì„ë² ë”©: 5ê°œ âœ…
- GraphDB í™•ì¥: 0ê°œ
- ë„ë©”ì¸: ìì²´ 10ê°œ, í˜‘ì—… 0ê°œ
```

**ì¿¼ë¦¬ 2**: (ë„ë©”ì¸ì— ì í•©í•œ ì§ˆì˜)
```
ê²€ìƒ‰ í†µê³„:
ì´ 10ê°œ ì¡°í•­ ë°œê²¬
- ë…¸ë“œ ì„ë² ë”©: 5ê°œ
- ê´€ê³„ ì„ë² ë”©: 5ê°œ âœ…
- GraphDB í™•ì¥: 0ê°œ
- ë„ë©”ì¸: ìì²´ 10ê°œ, í˜‘ì—… 0ê°œ
```

**ì¿¼ë¦¬ 3**: (ê´€ê³„ ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ)
```
ê²€ìƒ‰ í†µê³„:
ì´ 5ê°œ ì¡°í•­ ë°œê²¬
- ë…¸ë“œ ì„ë² ë”©: 5ê°œ
- ê´€ê³„ ì„ë² ë”©: 0ê°œ (ì •ìƒ - ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ)
- GraphDB í™•ì¥: 0ê°œ
- ë„ë©”ì¸: ìì²´ 5ê°œ, í˜‘ì—… 0ê°œ
```

#### ê²€ì¦ í•­ëª©

1. âœ… **ê´€ê³„ ì„ë² ë”© ê²€ìƒ‰ ì‘ë™**: 5ê°œ ê²°ê³¼ ë°˜í™˜
2. âœ… **ë…¸ë“œ ì„ë² ë”© ê²€ìƒ‰ ì‘ë™**: 5ê°œ ê²°ê³¼ ë°˜í™˜
3. âœ… **ì¤‘ë³µ ì œê±° ë° stages ë³‘í•©**: ì •ìƒ
4. âœ… **í†µê³„ ê³„ì‚° ì •í™•**: stages ë¦¬ìŠ¤íŠ¸ ê¸°ë°˜ ì¹´ìš´íŠ¸

#### í•µì‹¬ ìˆ˜ì • ì‚¬í•­

**ë¬¸ì œ**: ê´€ê³„ ê²€ìƒ‰ ê²°ê³¼ê°€ 0ê°œë¡œ ë‚˜íƒ€ë‚¨

**ì›ì¸**:
1. CONTAINS ê´€ê³„ ë°©í–¥: JO â†’ HANG (ê¸°ì¡´ ì¿¼ë¦¬ëŠ” HANG â†’ ? ë¡œ ì˜ëª»ë¨)
2. ì¤‘ë³µ ì œê±° ì‹œ stage ì •ë³´ ì†ì‹¤

**í•´ê²°**:
1. ì¿¼ë¦¬ ìˆ˜ì •: `MATCH (from)-[relationship]->(to:HANG)` + `to.full_id IN $node_ids`
2. stages ë¦¬ìŠ¤íŠ¸ ë„ì…: ì¤‘ë³µ HANGì˜ ëª¨ë“  ê²€ìƒ‰ ë°©ë²• ì •ë³´ ë³´ì¡´
3. í†µê³„ ê³„ì‚° ìˆ˜ì •: `'vector' in r.get('stages', [r.get('stage', '')])`

**ê²°ê³¼**: ê´€ê³„ ê²€ìƒ‰ ì •ìƒ ì‘ë™ âœ…

---

## ğŸ“Š ì „ì²´ íŒŒì´í”„ë¼ì¸ íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   PDF ì›ë³¸ íŒŒì¼ (3ê°œ)                             â”‚
â”‚   - ë²•ë¥  (468KB)                                                 â”‚
â”‚   - ì‹œí–‰ë ¹ (2.3MB)                                               â”‚
â”‚   - ì‹œí–‰ê·œì¹™ (1.9MB)                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“ [pdf_to_json.py]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   JSON íŒŒì‹± ê²°ê³¼ (3ê°œ)                            â”‚
â”‚   - ì „ì²´ units: 1,554ê°œ (ë²•ë¥ )                                   â”‚
â”‚   - ê³„ì¸µ: LAW â†’ JANG â†’ JEOL â†’ JO â†’ HANG â†’ HO                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“ [json_to_neo4j.py]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             Neo4j ê·¸ë˜í”„ ë°ì´í„°ë² ì´ìŠ¤                             â”‚
â”‚   - ë…¸ë“œ: 3,602ê°œ                                                â”‚
â”‚     â€¢ HANG: 1,477ê°œ                                             â”‚
â”‚     â€¢ JO: 770ê°œ                                                 â”‚
â”‚     â€¢ LAW: 3ê°œ                                                  â”‚
â”‚   - ê´€ê³„: 7,500+ê°œ                                              â”‚
â”‚     â€¢ CONTAINS: 3,565ê°œ                                         â”‚
â”‚     â€¢ NEXT: 2,842ê°œ                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“ [add_hang_embeddings.py]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               HANG ë…¸ë“œ ì„ë² ë”© ì¶”ê°€                               â”‚
â”‚   - ëª¨ë¸: KR-SBERT (jhgan/ko-sbert-sts)                         â”‚
â”‚   - ì°¨ì›: 768ì°¨ì›                                                â”‚
â”‚   - ê°œìˆ˜: 1,477ê°œ (100%)                                         â”‚
â”‚   - ì¸ë±ìŠ¤: hang_embedding_index (ONLINE)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“ [initialize_domains.py]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Domain ë…¸ë“œ ìƒì„± (K-means)                            â”‚
â”‚   - ë„ë©”ì¸: 5ê°œ                                                  â”‚
â”‚   - BELONGS_TO_DOMAIN: 1,477ê°œ (100%)                           â”‚
â”‚   - AgentManager ì´ˆê¸°í™”                                          â”‚
â”‚   - DomainAgent ì¸ìŠ¤í„´ìŠ¤ ìƒì„±                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“ [relationship_embedding/*]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            CONTAINS ê´€ê³„ ì„ë² ë”© ì¶”ê°€                              â”‚
â”‚   - ëª¨ë¸: OpenAI text-embedding-3-large                          â”‚
â”‚   - ì°¨ì›: 3,072ì°¨ì›                                              â”‚
â”‚   - ê°œìˆ˜: 3,565ê°œ (100%)                                         â”‚
â”‚   - ì¸ë±ìŠ¤: contains_embedding (ONLINE)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“ [DomainAgent]
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              í†µí•© ê²€ìƒ‰ ì‹œìŠ¤í…œ (ì™„ì„±)                              â”‚
â”‚   - ë²¡í„° ê²€ìƒ‰ (HANG ì„ë² ë”©) âœ…                                   â”‚
â”‚   - ê´€ê³„ ê²€ìƒ‰ (CONTAINS ì„ë² ë”©) âœ…                               â”‚
â”‚   - ê·¸ë˜í”„ í™•ì¥ (RNE) ì¤€ë¹„ë¨                                      â”‚
â”‚   - A2A í˜‘ì—… ì¤€ë¹„ë¨                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ í•µì‹¬ ë°œê²¬

### 1. ì´ì¤‘ ì„ë² ë”© ì „ëµ ì •ìƒ ì‘ë™

| íƒ€ì… | ëª¨ë¸ | ì°¨ì› | ê°œìˆ˜ | ìš©ë„ |
|-----|------|------|------|------|
| HANG ë…¸ë“œ | KR-SBERT | 768 | 1,477 | ì˜ë¯¸ ê¸°ë°˜ ë…¸ë“œ ê²€ìƒ‰ |
| CONTAINS ê´€ê³„ | OpenAI | 3,072 | 3,565 | êµ¬ì¡° ê¸°ë°˜ ê´€ê³„ ê²€ìƒ‰ |

### 2. Multi-Agent System ì •ìƒ

- **AgentManager**: 5ê°œ ë„ë©”ì¸ ê´€ë¦¬, 1,477ê°œ ì„ë² ë”© ìºì‹±
- **DomainAgent**: 5ê°œ ì¸ìŠ¤í„´ìŠ¤, ê°ê° ì „ë¬¸ ê²€ìƒ‰
- **Domain í• ë‹¹**: 100% (1,477/1,477)

### 3. ê²€ìƒ‰ ì‹œìŠ¤í…œ í†µí•©

- **Stage 1-A**: ë²¡í„° ê²€ìƒ‰ (HANG ì„ë² ë”©) âœ…
- **Stage 1-B**: ê´€ê³„ ê²€ìƒ‰ (CONTAINS ì„ë² ë”©) âœ…
- **Stage 2**: ê·¸ë˜í”„ í™•ì¥ (RNE) ì¤€ë¹„ë¨
- **Stage 3**: ì¬ë­í‚¹ (ì¤‘ë³µ ì œê±° + stages ë³‘í•©) âœ…

### 4. ë°ì´í„° í’ˆì§ˆ

- **JSON íŒŒì‹±**: ê³„ì¸µ êµ¬ì¡° ì •í™•
- **Neo4j ë¡œë“œ**: ë…¸ë“œ/ê´€ê³„ 100% ìƒì„±
- **ì„ë² ë”©**: 100% ìƒì„± (ì •ê·œí™” ì •ìƒ)
- **Domain í• ë‹¹**: 100% í• ë‹¹

---

## ğŸ“‚ í•µì‹¬ íŒŒì¼ ìœ„ì¹˜

### ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸

**ìœ„ì¹˜**: `law/STEP/`

| íŒŒì¼ | ìš©ë„ | ì†Œìš” ì‹œê°„ |
|-----|------|----------|
| `run_all.py` | ì „ì²´ ìë™ ì‹¤í–‰ | ~50ë¶„ |
| `step1_pdf_to_json.py` | PDF â†’ JSON | ~1ë¶„ |
| `step2_json_to_neo4j.py` | JSON â†’ Neo4j | ~2ë¶„ |
| `step3_add_hang_embeddings.py` | HANG ì„ë² ë”© | ~10ë¶„ |
| `step4_initialize_domains.py` | Domain ì´ˆê¸°í™” | ~5ë¶„ |
| `step5_run_relationship_embedding.py` | ê´€ê³„ ì„ë² ë”© | ~30ë¶„ |
| `verify_system.py` | ì‹œìŠ¤í…œ ê²€ì¦ | ~1ë¶„ |

### ë¬¸ì„œ

| íŒŒì¼ | ìš©ë„ |
|-----|------|
| `law/STEP/README.md` | ìˆœì°¨ ì‹¤í–‰ ê°€ì´ë“œ |
| `law/SYSTEM_GUIDE.md` | ì‹œìŠ¤í…œ í•™ìŠµ ê°€ì´ë“œ (7ë‹¨ê³„) |
| `docs/2025-11-13-LAW_NEO4J_COMPLETE_SETUP_GUIDE.md` | ì™„ì „ ì„¤ì • ê°€ì´ë“œ |
| `docs/2025-11-13-PIPELINE_VERIFICATION_TEST.md` | **ì´ ë¬¸ì„œ** |

### í•µì‹¬ ì½”ë“œ

| íŒŒì¼ | ìš©ë„ |
|-----|------|
| `agents/law/agent_manager.py` | AgentManager (ë„ë©”ì¸ ê´€ë¦¬) |
| `agents/law/domain_agent.py` | DomainAgent (ê²€ìƒ‰ ì‹¤í–‰) |
| `law/scripts/pdf_to_json.py` | PDF íŒŒì‹± |
| `law/scripts/json_to_neo4j.py` | Neo4j ë¡œë“œ |
| `law/scripts/add_hang_embeddings.py` | HANG ì„ë² ë”© |
| `law/scripts/initialize_domains.py` | Domain ì´ˆê¸°í™” |
| `law/relationship_embedding/step*.py` | ê´€ê³„ ì„ë² ë”© (10ë‹¨ê³„) |

---

## ğŸ”§ ì£¼ìš” ìˆ˜ì • ì‚¬í•­ (2025-11-13)

### ê´€ê³„ ê²€ìƒ‰ ë²„ê·¸ ìˆ˜ì •

**íŒŒì¼**: `agents/law/domain_agent.py`

#### ìˆ˜ì • 1: ì¿¼ë¦¬ ë°©í–¥ ìˆ˜ì • (line 220)

**ë¬¸ì œ**: CONTAINS ê´€ê³„ëŠ” JO â†’ HANG ë°©í–¥ì¸ë°, ì¿¼ë¦¬ê°€ HANG â†’ ? ë¡œ ê²€ìƒ‰

**ìˆ˜ì • ì „**:
```python
MATCH (from:HANG)-[relationship]->(to)
WHERE score >= 0.65
  AND from.full_id IN $node_ids
```

**ìˆ˜ì • í›„**:
```python
MATCH (from)-[relationship]->(to:HANG)
WHERE score >= 0.65
  AND to.full_id IN $node_ids
```

#### ìˆ˜ì • 2: stages ë¦¬ìŠ¤íŠ¸ ë„ì… (line 374-398)

**ë¬¸ì œ**: ë²¡í„° ê²€ìƒ‰ê³¼ ê´€ê³„ ê²€ìƒ‰ì´ ê°™ì€ HANGì„ ì°¾ìœ¼ë©´ ì¤‘ë³µ ì œê±° ì‹œ stage ì •ë³´ ì†ì‹¤

**ìˆ˜ì • ì „**:
```python
def _rerank_results(self, results, query_embedding):
    seen = set()
    unique_results = []
    for r in results:
        if r['hang_id'] not in seen:
            seen.add(r['hang_id'])
            unique_results.append(r)
    # stage ì •ë³´ ì¤‘ í•˜ë‚˜ë§Œ ë‚¨ìŒ
```

**ìˆ˜ì • í›„**:
```python
def _rerank_results(self, results, query_embedding):
    hang_dict = {}
    for r in results:
        hang_id = r['hang_id']
        if hang_id not in hang_dict:
            r['stages'] = [r['stage']]
            hang_dict[hang_id] = r
        else:
            existing = hang_dict[hang_id]
            if r['stage'] not in existing.get('stages', []):
                if 'stages' not in existing:
                    existing['stages'] = [existing['stage']]
                existing['stages'].append(r['stage'])
            if r['similarity'] > existing['similarity']:
                hang_dict[hang_id]['similarity'] = r['similarity']
    # ëª¨ë“  stage ì •ë³´ ë³´ì¡´
```

#### ìˆ˜ì • 3: í†µê³„ ê³„ì‚° ìˆ˜ì • (line 551-553)

**ë¬¸ì œ**: stage í•„ë“œë§Œ ì²´í¬í•˜ì—¬ stages ë¦¬ìŠ¤íŠ¸ ì •ë³´ ë¬´ì‹œ

**ìˆ˜ì • ì „**:
```python
vector_count = sum(1 for r in results if r.get('stage') == 'vector')
relationship_count = sum(1 for r in results if r.get('stage') == 'relationship')
```

**ìˆ˜ì • í›„**:
```python
vector_count = sum(1 for r in results if 'vector' in r.get('stages', [r.get('stage', '')]))
relationship_count = sum(1 for r in results if 'relationship' in r.get('stages', [r.get('stage', '')]))
```

**ê²°ê³¼**: ê´€ê³„ ê²€ìƒ‰ ì •ìƒ ì‘ë™ (5ê°œ ê²°ê³¼ ë°˜í™˜) âœ…

---

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„

### ì™„ë£Œëœ í•­ëª© âœ…

- [x] PDF íŒŒì‹±
- [x] JSON â†’ Neo4j ë¡œë“œ
- [x] HANG ì„ë² ë”© (KR-SBERT 768-dim)
- [x] Domain ì´ˆê¸°í™” (K-means)
- [x] CONTAINS ê´€ê³„ ì„ë² ë”© (OpenAI 3072-dim)
- [x] ë²¡í„° ê²€ìƒ‰
- [x] ê´€ê³„ ê²€ìƒ‰
- [x] DomainAgent í†µí•©

### ì¤€ë¹„ë¨ (êµ¬í˜„ ì™„ë£Œ, í…ŒìŠ¤íŠ¸ ëŒ€ê¸°)

- [ ] ê·¸ë˜í”„ í™•ì¥ (RNE ì•Œê³ ë¦¬ì¦˜)
- [ ] A2A ë„ë©”ì¸ í˜‘ì—…
- [ ] í’ˆì§ˆ ì ìˆ˜ ê¸°ë°˜ ë¼ìš°íŒ…

### í–¥í›„ ê°œì„ 

- [ ] GraphDB ê²½ë¡œ íƒìƒ‰ ì •í™•ë„ í–¥ìƒ
- [ ] ìƒìœ„ JO ì •ë³´ í‘œì‹œ ê°œì„ 
- [ ] Cross-law ì°¸ì¡° ê²€ìƒ‰
- [ ] ì‹¤ì‹œê°„ í”¼ë“œë°± ê¸°ë°˜ ì¬í•™ìŠµ

---

## ğŸ“ ì°¸ê³  ì‚¬í•­

### í…ŒìŠ¤íŠ¸ í™˜ê²½

- **OS**: Windows (win32)
- **Python**: 3.12
- **Neo4j**: 5.x (Desktop)
- **Django**: 5.2.6

### ì‹¤í–‰ ëª…ë ¹ì–´

```bash
# ì „ì²´ ì‹œìŠ¤í…œ ê²€ì¦
cd D:\Data\11_Backend\01_ARR\backend
.venv\Scripts\activate

# 1. Neo4j ìƒíƒœ í™•ì¸
python -c "from graph_db.services import Neo4jService; neo4j = Neo4jService(); neo4j.connect(); ..."

# 2. AgentManager ì´ˆê¸°í™”
python -c "from agents.law.agent_manager import AgentManager; manager = AgentManager()"

# 3. DomainAgent ê²€ìƒ‰ í…ŒìŠ¤íŠ¸
python law/test_domain_agent_final.py
```

### ì£¼ì˜ì‚¬í•­

1. **Neo4j Desktop ì‹¤í–‰ í•„ìˆ˜**: ë°ì´í„°ë² ì´ìŠ¤ê°€ ì‹¤í–‰ ì¤‘ì´ì–´ì•¼ í•¨
2. **í™˜ê²½ ë³€ìˆ˜ ì„¤ì •**: `.env` íŒŒì¼ì— `NEO4J_*`, `OPENAI_API_KEY` í•„ìš”
3. **ê°€ìƒí™˜ê²½ í™œì„±í™”**: `.venv\Scripts\activate`
4. **ì¸ì½”ë”© ì˜¤ë¥˜**: Windows ì½˜ì†” cp949 ì¸ì½”ë”©ìœ¼ë¡œ ì¼ë¶€ ë¡œê·¸ ì˜¤ë¥˜ (ê¸°ëŠ¥ì—ëŠ” ì˜í–¥ ì—†ìŒ)

---

## âœ… ê²°ë¡ 

**PDF íŒŒì‹±ë¶€í„° DomainAgent ê²€ìƒ‰ê¹Œì§€ ì „ì²´ íŒŒì´í”„ë¼ì¸ì´ ìˆœì°¨ì ìœ¼ë¡œ ì™„ë²½í•˜ê²Œ ì‘ë™í•©ë‹ˆë‹¤!**

- ë°ì´í„° í’ˆì§ˆ: 100% (ì„ë² ë”©, ë„ë©”ì¸ í• ë‹¹)
- ê²€ìƒ‰ ì •í™•ë„: ë²¡í„° + ê´€ê³„ ê²€ìƒ‰ ëª¨ë‘ ì‘ë™
- ì‹œìŠ¤í…œ ì•ˆì •ì„±: ëª¨ë“  ë‹¨ê³„ ê²€ì¦ í†µê³¼

**ë‹¤ìŒ AIëŠ” ì´ ë¬¸ì„œì™€ `law/STEP/README.md`ë¥¼ ë”°ë¼ ì „ì²´ ì‹œìŠ¤í…œì„ ì¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2025-11-13
**ê²€ì¦ì**: Claude AI (Sonnet 4.5)
**ìƒíƒœ**: âœ… ì „ì²´ íŒŒì´í”„ë¼ì¸ ê²€ì¦ ì™„ë£Œ
